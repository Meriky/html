  <h4>使用 HTML 编写安全应用</h4>

  <!-- NON-NORMATIVE SECTION -->

  <p>当使用 HTML 创建交互式网站时，需要注意避免引入漏洞，使得攻击者通过这些漏洞危害网站本身或网站用户信息的完整性。</p>

  <p>对这一问题的全面研究超出了本文档的范围，我们强烈建议网站作者去更详细地研究这一问题。
  即便如此，本节尝试对 HTML 应用程序开发中的一些常见陷阱作简单介绍。</p>

  <p>Web 的安全模型基于“域”的概念，因此 Web 上许多潜在的攻击涉及跨域操作。<ref spec=ORIGIN></p>

  <dl>

   <dt>不验证用户输入</dt>
   <dt>跨站脚本（XSS）</dt>
   <dt>SQL 注入</dt>

   <dd>

    <p>当接受不可信输入时（例如文本评论这样的用户生成内容，URL 参数中的值，来自第三方网站的消息等），
    必须在使用前验证数据，并在显示时正确转义。 否则就会允许恶意的用户执行各种攻击，
    这些攻击可能是轻微的，例如提供诸如负的年龄这样的假的用户信息；
    也可能是严重的，例如在每次用户查看包含该信息的页面时执行脚本；
    也可能是传播性的攻击导致灾难性后果，比如删除服务器中的所有数据。</p>

    <p>当编写过滤器验证用户输入时，过滤器应当是基于白名单的，允许已知的安全构造并禁止所有其他输入。
    基于黑名单的过滤器（禁止已知的错误输入并允许其他所有输入）是不安全的，
    因为并不是所有错误输入都是已知的（因为它可能会在未来发明）。</p>

    <div class="example">

     <p>例如，一个页面查看它的 URL 查询字符串来决定显示的内容，
     然后网站将用户重定向到显示该消息的页面。比如：</p>

     <pre>&lt;ul>
 &lt;li>&lt;a href="message.cgi?say=Hello">Say Hello&lt;/a>
 &lt;li>&lt;a href="message.cgi?say=Welcome">Say Welcome&lt;/a>
 &lt;li>&lt;a href="message.cgi?say=Kittens">Say Kittens&lt;/a>
&lt;/ul></pre>

     <p>如果这一消息没有转义就显示给用户，恶意的攻击者可能会构造一个包含脚本元素的 URL：</p>

     <pre>https://example.com/message.cgi?say=%3Cscript%3Ealert%28%27Oh%20no%21%27%29%3C/script%3E</pre>

     <p>如果攻击者随后说服受害者访问此页面，攻击者选择的脚本将在页面上运行。
     这样的脚本可以执行任意的恶意操作，只要是站点提供的。
     例如站点是电子商务商店，这样的脚本可以导致在用户不知情的情况下进行任意的购买。</p>

     <p>这称为跨站脚本攻击。</p>

    </div>

    <p>有很多构造可以欺骗网站执行代码。以下是网站作者在编写白名单过滤器时应考虑的事项：</p>

    <ul>

     <li>当允许像<code>img</code>这样看起来无害的元素时，重要的是同时为所有提供的属性给出白名单。
     比如，如果一个元素允许所有属性，攻击者可能会使用<code data-x="handler-onload">onload</code>属性来运行任意脚本。</li>

     <li>当允许提供 URL 时（比如 link），每一个 URL 的 scheme 也需要显式地给出白名单。
     因为有很多 scheme 都可能会被滥用。最著名的例子是：“<code data-x="javascript protocol">javascript:</code>”，
     用户代理也可能会实现其他的一些scheme，由于历史原因确实已经实现了不少。</li> <!-- IE had vbscript:,
     Netscape had livescript:, etc. -->

     <li>允许插入 <code>base</code> 元素意味着页面中的任何相对链接的 <code>script</code> 元素都可能被劫持，
     类似地任何表单提交也可能重定向到恶意站点。</li>

    </ul>

   </dd>


   <dt>跨站请求伪造 (CSRF)</dt>

   <dd>

    <p>如果网站允许用户提交的表单产生用户相关的影响，例如使用名字在论坛上发布消息，
    进行购买或申请护照，那么很有必要核实该请求确实是用户有意发起的，
    而不是由另一个站点欺骗用户不知情地发起请求。</p>

    <p>该问题的存在是因为 HTML 表单可能被提交到其他域名。</p>

    <p>站点可以通过为表单填充用户相关的隐藏标记或检查所有请求的`<code data-x="http-origin">Origin</code>`头字段，
    来防止这样的攻击。</p>

   </dd>



   <dt>Clickjacking</dt>

   <dd>

    <p>如果页面为用户提供的界面中包含用户可能不希望执行的操作时，
    该页面应当经过特殊设计来避免用户被欺骗以激活该界面的可能性。</p>

    <p>一种用户被欺骗的可能是，如果恶意站点将受害站点放在一个小的 <code>iframe</code> 中然后让用户去点击，
    例如让用户玩一个反应类游戏。一旦用户开始玩这个游戏，恶意站点可以在用户正要点击时快速地将这个 iframe 放到鼠标光标下。
    以此来欺骗用户点击受害站点的界面。</p>

    <p>为了避免这种情况，鼓励不期望在 iframe 下使用的站点只有检测（例如通过比较<code data-x="dom-window">window</code>对象和<code data-x="dom-top">top</code>属性的值）
    到它们不在 iframe 下时才激活它们的界面。</p>

   </dd>

  </dl>
<!--REMOVE-TOPIC:Security-->


